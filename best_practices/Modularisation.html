<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Locality, locality locality" href="Locality.html" /><link rel="prev" title="Best Practices" href="index.html" />

    <meta name="generator" content="sphinx-7.1.2, furo 2021.11.16"/>
        <title>Modularisation - Numerics for Solitons</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=916d6ed8f59335acffa15474ff504849343d4c76" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=0af69da206d614734f649b27d4cdc2dd6c31f41d" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Numerics for Solitons</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">Numerics for Solitons</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Best Practices</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Modularisation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Locality.html">Locality, locality locality</a></li>
<li class="toctree-l2"><a class="reference internal" href="OOC.html">Object oriented coding</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../getting_started/index.html">Getting Started</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/Choosing.html">Choosing a language</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/C%2B%2B.html">C++</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/Python.html">Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/Julia.html">Julia</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../how_to/index.html">How to</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../how_to/Grid.html">Make a Grid</a></li>
<li class="toctree-l2"><a class="reference internal" href="../how_to/Derivatives.html">Derivatives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../how_to/GradientFlow.html">Gradient Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../how_to/TimeEvolution.html">Time evolution</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../examples/index.html">Examples</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples/KinkEnergy.html">Calculate the kink energy, in Julia</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute.html">Contribute</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="modularisation">
<h1>Modularisation<a class="headerlink" href="#modularisation" title="Permalink to this heading"><span>#</span></a></h1>
<p>Modularisation says ``PUT EVERYTHING IN A FUNCTION!!!”. And a function should do one thing
and do that thing well. It’s key to the Don’t Repeat Yourself (DRY) mindset. Do you have two functions which can take a derivative? That’s one too many! So there should be one simple
function for each task. A side-tip: that function’s name should be so good that you don’t
need comments.</p>
<p>We’ll examine this idea by <em>refactoring</em> some code. Refactoring is when you take a large, ugly
function and turn it into several smaller functions. Suppose we’re trying to calculate the energy
of a <span class="math notranslate nohighlight">\(\phi^4\)</span> kink. Currently, we have two functions. One returns the total energy and the other
returns the energy density. Both are useful: sometimes you need the energy density and sometimes
you need the energy. We’re using a kink <em>object</em> (learn more here):</p>
<div class="highlight-Julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">calculate_energy</span><span class="p">(</span><span class="n">kink</span><span class="o">::</span><span class="kt">Kink</span><span class="p">)</span>

<span class="w">    </span><span class="n">total_energy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="n">kink</span><span class="o">.</span><span class="n">lp</span><span class="o">-</span><span class="mi">1</span>
<span class="w">        </span><span class="n">dkink</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">kink</span><span class="o">.</span><span class="n">field</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">kink</span><span class="o">.</span><span class="n">field</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">kink</span><span class="o">.</span><span class="n">ls</span><span class="p">)</span>
<span class="w">        </span><span class="n">total_energy</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mf">0.5</span><span class="o">*</span><span class="n">dkink</span><span class="o">^</span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">kink</span><span class="o">.</span><span class="n">field</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">^</span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span>
<span class="w">    </span><span class="k">end</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">total_energy</span><span class="o">*</span><span class="n">kink</span><span class="o">.</span><span class="n">ls</span>

<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">calculate_energy_density</span><span class="p">(</span><span class="n">kink</span><span class="o">::</span><span class="kt">Kink</span><span class="p">)</span>

<span class="w">    </span><span class="n">energy_density</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">kink</span><span class="o">.</span><span class="n">lp</span><span class="p">)</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="n">kink</span><span class="o">.</span><span class="n">lp</span><span class="o">-</span><span class="mi">1</span>
<span class="w">        </span><span class="n">dkink</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">kink</span><span class="o">.</span><span class="n">field</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">kink</span><span class="o">.</span><span class="n">field</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">kink</span><span class="o">.</span><span class="n">ls</span><span class="p">)</span>
<span class="w">        </span><span class="n">energy_density</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="o">*</span><span class="n">dkink</span><span class="o">^</span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">kink</span><span class="o">.</span><span class="n">field</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">^</span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span>
<span class="w">    </span><span class="k">end</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">energy_density</span>

<span class="k">end</span>
</pre></div>
</div>
<p>There are several problems with this code: 2nd order derivatives aren’t very accurate and we’re
ignoring boundary points. Learn more in the derivatives and boundary conditions sections.</p>
<p>Ok! Let’s refactor. We’re repeating ourselves a lot. Let’s start by defining kinetic and potential functions, and a function to calculate the derivative:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">potential_energy</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
    <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">phi</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span>
<span class="n">end</span>

<span class="n">function</span> <span class="n">kinetic_energy</span><span class="p">(</span><span class="n">dphi</span><span class="p">)</span>
    <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dphi</span><span class="o">^</span><span class="mi">2</span>
<span class="n">end</span>

<span class="n">function</span> <span class="n">dx</span><span class="p">(</span><span class="n">kink</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">kink</span><span class="o">.</span><span class="n">field</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">kink</span><span class="o">.</span><span class="n">field</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">kink</span><span class="o">.</span><span class="n">ls</span><span class="p">)</span>
<span class="n">end</span>
</pre></div>
</div>
<p>and update our energy functions too</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">calculate_energy</span><span class="p">(</span><span class="n">kink</span><span class="p">::</span><span class="n">Kink</span><span class="p">)</span>

    <span class="n">total_energy</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="mi">2</span><span class="p">:</span><span class="n">kink</span><span class="o">.</span><span class="n">lp</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">dkink</span> <span class="o">=</span> <span class="n">dx</span><span class="p">(</span><span class="n">kink</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">total_energy</span> <span class="o">+=</span> <span class="n">derivative_energy</span><span class="p">(</span><span class="n">dkink</span><span class="p">)</span> <span class="o">+</span> <span class="n">potential_energy</span><span class="p">(</span><span class="n">kink</span><span class="o">.</span><span class="n">field</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">end</span>

    <span class="k">return</span> <span class="n">total_energy</span><span class="o">*</span><span class="n">kink</span><span class="o">.</span><span class="n">ls</span>

<span class="n">end</span>

<span class="n">function</span> <span class="n">calculate_energy_density</span><span class="p">(</span><span class="n">kink</span><span class="p">::</span><span class="n">Kink</span><span class="p">)</span>

    <span class="n">energy_density</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">kink</span><span class="o">.</span><span class="n">lp</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="mi">2</span><span class="p">:</span><span class="n">kink</span><span class="o">.</span><span class="n">lp</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">dkink</span> <span class="o">=</span> <span class="n">dx</span><span class="p">(</span><span class="n">kink</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">energy_density</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">derivative_energy</span><span class="p">(</span><span class="n">dkink</span><span class="p">)</span> <span class="o">+</span> <span class="n">potential_energy</span><span class="p">(</span><span class="n">kink</span><span class="o">.</span><span class="n">field</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">end</span>

    <span class="k">return</span> <span class="n">energy_density</span>

<span class="n">end</span>
</pre></div>
</div>
<p>So, what’s nice about this? First, it’s easier to read the energy functions. Second, suppose
you want to now study the <span class="math notranslate nohighlight">\(\phi^6\)</span> model. Now you only need
to change one thing - the <code class="docutils literal notranslate"><span class="pre">potential_energy</span></code> function! So, it’s more likely your two energy functions will be consistent. But
having two energy functions is a bit of a pain. So let’s turn them into one. We’ll do this by
adding a boolean keyword argument to <code class="docutils literal notranslate"><span class="pre">calculate_energy</span></code> called <code class="docutils literal notranslate"><span class="pre">density</span></code>. If this is true, we’ll
return a density and if it’s false, we’ll return the energy. To make this work, we’ll
change things a little</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">calculate_energy</span><span class="p">(</span><span class="n">kink</span><span class="p">::</span><span class="n">Kink</span><span class="p">;</span> <span class="n">density</span><span class="o">=</span><span class="n">false</span><span class="p">)</span>

    <span class="n">energy_density</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">kink</span><span class="o">.</span><span class="n">lp</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="mi">2</span><span class="p">:</span><span class="n">kink</span><span class="o">.</span><span class="n">lp</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">dkink</span> <span class="o">=</span> <span class="n">dx</span><span class="p">(</span><span class="n">kink</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">energy_density</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">derivative_energy</span><span class="p">(</span><span class="n">dkink</span><span class="p">)</span> <span class="o">+</span> <span class="n">potential_energy</span><span class="p">(</span><span class="n">kink</span><span class="o">.</span><span class="n">field</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">end</span>

    <span class="c1"># note: `if density` is shorthand for `if density == true`</span>
    <span class="k">if</span> <span class="n">density</span>
        <span class="k">return</span> <span class="n">total_energy</span><span class="o">*</span><span class="n">kink</span><span class="o">.</span><span class="n">ls</span>
    <span class="k">else</span>
        <span class="k">return</span> <span class="n">energy_density</span>
    <span class="n">end</span>

<span class="n">end</span>
</pre></div>
</div>
<p>Nice! We now have a 2-for-1 function. This will give us the energy or the energy density
depending on what we feed it. In some ways this is more complicated than before:
we have a more complicated function (bad) but we only have one place where we calculate
the energy (good). Is this the best function? Should you make a <code class="docutils literal notranslate"><span class="pre">get_energy_at_point</span></code>
function? Or go back to what it looked like before? Of course, it’s up to you. But
hopefully this guide has given you a feeling for what you <em>might</em> want to do.</p>
<section id="a-quick-note-on-speed">
<h2>A quick note on speed.<a class="headerlink" href="#a-quick-note-on-speed" title="Permalink to this heading"><span>#</span></a></h2>
<p>On Julia, we can benchmark functions very easily. In our refactoring, it didn’t
feel like we changed much. In fact, our final solution looks <em>worse</em> speed wise when we
calculate the energy, because we make an energy density array and don’t use it.</p>
<p>Here’s my output when I benchmark the original functions on a 10,000 point kink:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_kink</span> <span class="o">=</span> <span class="n">Kink</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">my_kink</span><span class="o">.</span><span class="n">field</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">10000</span><span class="p">);</span>
<span class="nd">@btime</span> <span class="n">calculate_energy</span><span class="p">(</span><span class="n">my_kink</span><span class="p">)</span>
<span class="c1"># 927.166 μs (58461 allocations: 913.45 KiB)</span>
</pre></div>
</div>
<p>almost a millisecond.  Now with the new refactored functions. Drumroll…</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@btime</span> <span class="n">calculate_energy</span><span class="p">(</span><span class="n">my_kink</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">false</span><span class="p">)</span>
<span class="c1"># 911.792 μs (58460 allocations: 991.58 KiB)</span>
</pre></div>
</div>
<p>…it’s the same(ish). It turns out that making an array of zeros doesn’t affect
things much. For very large objects this can be a problem for memory, but we’re
a far way off this first. Just note that your instinct about what is slow and
what is fast in code might be very wrong. Mine is! The only way to find out is to
check.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="Locality.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Locality, locality locality</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Best Practices</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2024, the Soliton Community |
          Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
          <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            | <a class="muted-link" href="../_sources/best_practices/Modularisation.md.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Modularisation</a><ul>
<li><a class="reference internal" href="#a-quick-note-on-speed">A quick note on speed.</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/scripts/furo.js?v=818c8f69"></script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>